<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Frame Test</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        #videoFeed { border: 1px solid black; max-width: 960px; height: auto; }
        #status { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Live Video Stream</h1>
    <img id="videoFeed" src="" alt="Video Feed">
    <div id="status">Connecting...</div>

    <script>
        const videoFeed = document.getElementById('videoFeed');
        const statusDiv = document.getElementById('status');
        const wsUrl = 'ws://localhost:8765'; // Or use server's actual IP if not localhost
        let ws;

        function connect() {
            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                statusDiv.textContent = 'Connected to WebSocket server.';
                console.log('WebSocket connection established');
            };

            ws.onmessage = (event) => {
                try {
                    const message = JSON.parse(event.data);
                    if (message.type === 'frame' && message.data) {
                        videoFeed.src = 'data:image/jpeg;base64,' + message.data;
                        // statusDiv.textContent = `Frame received at: ${message.timestamp}`;
                    }
                } catch (e) {
                    console.error('Error processing message or invalid JSON:', e, event.data);
                    statusDiv.textContent = 'Error processing message.';
                }
            };

            ws.onerror = (error) => {
                console.error('WebSocket Error:', error);
                statusDiv.textContent = 'WebSocket error. Check console.';
            };

            ws.onclose = (event) => {
                statusDiv.textContent = `WebSocket closed: ${event.reason || 'No reason specified'}. Attempting to reconnect in 3 seconds...`;
                console.log('WebSocket connection closed. Code:', event.code, 'Reason:', event.reason);
                videoFeed.src = ""; // Clear image
                setTimeout(connect, 3000); // Attempt to reconnect
            };
        }

        connect(); // Initial connection attempt
    </script>
</body>
</html>